#!/bin/bash

# Chloe Alpha Pre-Push Security Hook
# Prevents accidental commits of secrets, runtime data, or cache files

echo "üîç Chloe Security Check: Scanning for sensitive files..."

# Check for sensitive files that should never be committed
SENSITIVE_FILES=$(git diff --cached --name-only | egrep -i '\.env$|systemd/.*\.env$|\.pem$|\.key$|\.p12$|reports/|logs/')

if [ ! -z "$SENSITIVE_FILES" ]; then
    echo "üö® SECURITY VIOLATION: Sensitive files detected in staging area!"
    echo ""
    echo "Files that should NOT be committed:"
    echo "$SENSITIVE_FILES"
    echo ""
    echo "These files contain secrets, runtime data, or cache files."
    echo "Remove them from staging with: git rm --cached <file>"
    echo ""
    exit 1
fi

# Check for __pycache__ files
PYCACHE_FILES=$(git diff --cached --name-only | grep __pycache__)

if [ ! -z "$PYCACHE_FILES" ]; then
    echo "‚ö†Ô∏è  WARNING: __pycache__ files detected in staging area!"
    echo ""
    echo "Python cache files should not be committed:"
    echo "$PYCACHE_FILES"
    echo ""
    echo "Remove them with: git rm --cached -r __pycache__"
    echo "Or add to .gitignore if not already there."
    echo ""
    echo "Continuing anyway... (not blocking)"
fi

echo "‚úÖ Security check passed. Push allowed."
exit 0
